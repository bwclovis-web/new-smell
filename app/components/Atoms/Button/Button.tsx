import { type VariantProps } from "class-variance-authority"
import { type ButtonHTMLAttributes, type LinkHTMLAttributes, type ReactNode, type Ref } from "react"
import { NavLink } from "react-router"

import { styleMerge } from "~/utils/styleUtils"

import { buttonVariants } from "./button-variants"

interface ButtonProps
  extends Omit<ButtonHTMLAttributes<HTMLButtonElement>, "style">,
    VariantProps<typeof buttonVariants> {
  variant?: "primary" | "secondary" | "danger" | "icon" | null
  ref?: Ref<HTMLButtonElement>
  leftIcon?: ReactNode
  rightIcon?: ReactNode
}

interface LinkProps
  extends Omit<LinkHTMLAttributes<HTMLAnchorElement>, "style">,
    VariantProps<typeof buttonVariants> {
  variant?: "primary" | "secondary" | "danger" | "link" | "icon" | null
  url: string
  ref?: Ref<HTMLAnchorElement>
  background?: "red" | "gold" | null
}

const Button = ({
  className,
  size,
  variant,
  children,
  background,
  leftIcon,
  rightIcon,
  type = "button",
  ref,
  ...props
}: ButtonProps) => (
  <button
    className={
      styleMerge(buttonVariants({ className, size, variant, background,
        leftIcon: leftIcon ? true : false, rightIcon: rightIcon ? true : false }))}
    data-cy="button"
    type={type}
    ref={ref}
    {...props}
  >
    {leftIcon && <span>{leftIcon}</span>}
    {children}
    {rightIcon && <span>{rightIcon}</span>}
  </button>
)

const VooDooLink = ({
  className,
  size,
  variant,
  children,
  url,
  background,
  ...props
}: LinkProps) => (
  <NavLink
    to={url}
    viewTransition
    prefetch="intent"
    className={styleMerge(buttonVariants({ className, size, variant, background }))}
    {...props}
  >
    {children}
  </NavLink>
)
export { Button, VooDooLink }
